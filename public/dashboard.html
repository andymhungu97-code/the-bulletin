<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="nav"></div>
  <div class="container">
    <h1>Dashboard</h1>
    <button onclick="logout()">Logout</button>

    <h2>Create Post</h2>
    <input type="text" id="title" placeholder="Title"><br><br>
    <input type="text" id="category" placeholder="Category"><br><br>
    <textarea id="content" placeholder="Content"></textarea><br>
    <input type="file" id="images" multiple><br><br>
    <button onclick="createPost()">Publish</button>

    <h2>Your Posts</h2>
    <div id="posts"></div>
  </div>

  <script>
fetch("nav.html")
  .then(r => r.text())
  .then(html => {
    document.getElementById("nav").innerHTML = html;

    const toggle = document.querySelector(".menu-toggle");
    const navItems = document.querySelector(".nav_items");

    toggle.addEventListener("click", () => {
      toggle.classList.toggle("active");
      navItems.classList.toggle("active");
    });
  });

    const backendUrl = window.location.origin;
    const token = localStorage.getItem("token");
    if(!token) window.location.href="login.html";

    async function fetchPosts(){
      const res = await fetch(`${backendUrl}/api/posts`);
      const posts = await res.json();
      document.getElementById("posts").innerHTML = posts.map(p=>`
        <div class="post-card">
          <h3>${p.title}</h3>
          <p>${p.category} | ${new Date(p.createdAt).toLocaleString()}</p>
          <p>${p.content}</p>
          <button onclick="deletePost('${p._id}')">Delete</button>
        </div>
      `).join("");
    }

    async function createPost() {
  const title = document.getElementById("title").value;
  const category = document.getElementById("category").value;
  const content = document.getElementById("content").value;
  const files = document.getElementById("images").files;

  const formData = new FormData();
  formData.append("title", title);
  formData.append("category", category);
  formData.append("content", content);

  for (let i = 0; i < files.length; i++) {
    formData.append("images", files[i]);
  }

  const res = await fetch("/api/posts", {
    method: "POST",
    headers: {
      Authorization: "Bearer " + localStorage.getItem("token")
    },
    body: formData
  });

  if (res.ok) {
    alert("Post created!");
    window.location.reload();
  } else {
    alert("Failed to create post");
  }
}

    async function deletePost(id){
      await fetch(`${backendUrl}/api/posts/${id}`,{
        method:"DELETE",
        headers:{Authorization:"Bearer "+token}
      });
      fetchPosts();
    }

    function logout(){ localStorage.removeItem("token"); window.location.href="login.html"; }

    fetchPosts();
  </script>
</body>
</html>